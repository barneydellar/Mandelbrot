<html>
<head>
    <title>Mandelbrot</title>
    <meta http-equiv=Content-Type content='text/html; charset=utf-8'>
    <meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://hammerjs.github.io/dist/hammer.js"></script>
    <script src="mandelbrot.js"></script>
    <script src="mandelbrotMouse.js"></script>
    <script>

        //-------------------------------------------------------------------------------------

        function NewMandelbrot() {

            if (request_in_progress) {
                return;
            }
            request_in_progress = true;

            fetch(
                "/Mandelbrot",
                {
                    method: "POST",
                    body: JSON.stringify({
                        canvas_width: full_w,
                        canvas_height: full_h,
                        scale: scale*1.01,
                        x: offset_x,
                        y: offset_y
                    }),
                    headers: { 'Content-Type': 'application/json' }
                }
            )
                .then(data => { return data.json() })
                .then(json_data => {
                    StopColourLoop();
                    escape_array = json_data["Array"];
                    scale = json_data["Scale"];
                    DrawCanvas();
                    StartColourLoop();
                    request_in_progress = false;
                })
                .catch(function () {
                    console.log("Failed to get data");
                    request_in_progress = false;
                });
        }


    </script>

</head>
    <body>
        <canvas id="MandelbrotCanvas">
        </canvas>
    </body>
</html>